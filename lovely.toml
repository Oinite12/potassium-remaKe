[manifest]
version = "1.0.0"
dump_lua = true
priority = 0

# function G.FUNCS.evaluate_play
# Tag calculations pre-scoring
[[patches]]
[patches.pattern]
target = "functions/state_events.lua"
pattern = '''mult, hand_chips = mod_mult(mult), mod_chips(hand_chips)'''
position = "after"
payload = '''check_and_set_high_score('best_glop', glop)
for i = 1, #G.GAME.tags do
    G.GAME.tags[i]:apply_to_run({type = 'scoring'})
end'''
match_indent = true

# function update_hand_text
# Floating point resolution (visual)
[[patches]]
[patches.pattern]
target = "functions/common_events.lua"
pattern = '''if delta < 0 then delta = ''..delta; col = G.C.RED'''
position = "before"
payload = '''
delta = tonumber(('%.3f'):format(delta))
'''
match_indent = true

# function SMODS.calculate_effect
# Increase Glop per chip/mult/glop/etc increase
[[patches]]
[patches.pattern]
target = '''=[SMODS _ "src/utils.lua"]'''
pattern = '''
if effect[key] then
'''
position = "after"
payload = '''
if Potassium.calc_keys.all[key] then
    SMODS.Scoring_Parameters.kali_glop:modify(0.01)
end
'''
match_indent = true